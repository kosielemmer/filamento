{% extends 'base.html' %}

{% block content %}
<h1>Current Inventory</h1>
<div class="table-container">
    <table id="inventoryTable" class="display">
        <thead>
            <tr>
                <th>Manufacturer</th>
                <th>Filament Type</th>
                <th>Color</th>
                <th>Location</th>
                <th>Color Sample</th>
            </tr>
        </thead>
        <tbody>
            {% for item in inventory %}
            <tr>
                <td>{{ item[0] }}</td>
                <td>{{ item[1] }}</td>
                <td>{{ item[2] }}</td>
                <td>{{ item[3] }}</td>
                <td><div class="color-sample-container"><div class="color-sample" style="background-color: {{ item[4] }};" title="{{ item[2] }}"></div></div></td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
<a href="{{ url_for('index') }}" class="btn btn-small">Back to Main Page</a>

<script type="text/javascript" charset="utf8" src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.10.25/js/jquery.dataTables.js"></script>

<script>
$(document).ready(function() {
    $('#inventoryTable').DataTable({
        "pageLength": 25,
        "lengthMenu": [[10, 25, 50, -1], [10, 25, 50, "All"]],
        "order": [[0, "asc"]],
        "columnDefs": [
            { "orderable": false, "targets": 4 }
        ],
        "dom": '<"top"if>rt<"bottom"lp><"clear">',
        "language": {
            "search": "Filter:"
        },
        "drawCallback": function(settings) {
            // Re-apply color sample styles after each draw
            $('.color-sample').each(function() {
                var color = $(this).attr('style').match(/background-color: (.*?);/)[1];
                $(this).css({
                    'background-color': color,
                    'border': '1px solid ' + (isLightColor(color) ? '#000' : '#fff')
                });
            });
        }
    });

    // Function to determine if a color is light or dark
    function isLightColor(color) {
        var r, g, b, hsp;
        if (color.match(/^rgb/)) {
            color = color.match(/^rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d+(?:\.\d+)?))?\)$/);
            r = color[1];
            g = color[2];
            b = color[3];
        } else {
            color = +("0x" + color.slice(1).replace(color.length < 5 && /./g, '$&$&'));
            r = color >> 16;
            g = color >> 8 & 255;
            b = color & 255;
        }
        hsp = Math.sqrt(0.299 * (r * r) + 0.587 * (g * g) + 0.114 * (b * b));
        return hsp > 127.5;
    }
});
</script>
{% endblock %}
